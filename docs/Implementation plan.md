---
description: "Implementation plan for Telegram City Quest Bot (python-telegram-bot, GitHub CSV storage)"
alwaysApply: false
---

# Implementation Plan

**Каждая задача имеет статус (TODO/DONE). Работу нужно начинать с первого невыполненного пункта.**

---

## Milestone 1: Инициализация проекта и окружения

- TODO: Создать структуру проекта с основными папками:
    - /src
    - /src/commands
    - /src/services
    - /src/utils
    - /src/middleware
    - /src/config
    - /tests
    - /data
- TODO: Создать README.md с кратким описанием проекта и стека
- TODO: Создать .gitignore ДО первого коммита, обязательно включить .env и другие чувствительные файлы
- TODO: Создать pyproject.toml или requirements.txt с зависимостями:
    - python-telegram-bot
    - PyGithub
    - python-dotenv
    - ruff и black (линтер/форматтер)
- TODO: Создать .env.example с шаблоном переменных окружения (Telegram token, GitHub token, repo name)
- TODO: Настроить ruff и black для автоматической проверки и форматирования кода
- TODO: Создать Dockerfile на базе python:3.12-slim (порядок операций: pyproject.toml/requirements.txt, src/, pip install)
- TODO: Создать .dockerignore для оптимизации контекста сборки
- TODO: Сделать первый коммит в репозиторий

---

## Milestone 2: Базовая логика Telegram-бота

- TODO: Создать /src/bot.py — основная точка входа Telegram-бота
- TODO: Подключить python-telegram-bot и реализовать инициализацию приложения
- TODO: Реализовать обработку команды /start, отправку приветствия и правил игры
- TODO: Реализовать отправку первого задания пользователю (загрузка из routes.csv через GitHub raw URL)
- TODO: Реализовать обработку и проверку геолокации пользователя с радиусом 50 метров
- TODO: Реализовать реакцию на неверную локацию («Почти! Попробуй еще раз»)
- TODO: Реализовать переход к следующему заданию при правильной локации
- TODO: Реализовать хранение прогресса пользователя (запись в progress.csv через GitHub API)
- TODO: Реализовать автоматический сброс прогресса через 30 дней неактивности

---

## Milestone 3: Работа с CSV-файлами на GitHub

- TODO: Реализовать загрузку маршрутов из публичного файла routes.csv (GitHub raw URL)
- TODO: Реализовать запись и обновление файла progress.csv через GitHub API (с помощью PyGithub)
- TODO: Создать сервис /src/services/routes.py для загрузки и парсинга routes.csv
- TODO: Создать сервис /src/services/progress.py для работы с файлом progress.csv (чтение/запись)
- TODO: Написать тесты для ключевых сценариев (успешное прохождение, неверная локация, сброс прогресса)

---

## Milestone 4: Финализация, деплой и документация

- TODO: Настроить деплой Python-приложения на Railway
- TODO: Протестировать работу бота в Telegram, корректность загрузки/записи CSV на GitHub
- TODO: Добавить финальное поздравление и предложение пройти квест снова
- TODO: Провести финальный рефакторинг и ревью кода
- TODO: Оформить итоговую документацию (README, примеры заданий, структура .env, примеры routes.csv и progress.csv)
- TODO: Подготовить и оформить релиз MVP

---

## Acceptance Checklist

- [ ] Проект инициализирован, структура соответствует PRD и file_structure_document
- [ ] Все переменные окружения скрыты и защищены (.env в .gitignore)
- [ ] Локальная сборка и запуск через Docker работают без ошибок
- [ ] Линтер и форматтер настроены и проходят без ошибок
- [ ] Бот корректно отвечает на команды и сообщения в Telegram
- [ ] Проверка геолокации реализована с радиусом 50 метров
- [ ] Загрузка маршрутов из routes.csv и запись прогресса в progress.csv на GitHub работают корректно
- [ ] Прогресс пользователя сбрасывается через 30 дней неактивности
- [ ] Все бизнес-критические сценарии покрыты тестами
- [ ] Деплой на Railway произведён, бот стабильно работает в облаке
- [ ] Документация написана и содержит актуальную информацию

---

> **@Cursor**: После завершения задачи поменяй её статус на DONE и добавь краткий маркер «// done by Cursor» с описанием, что именно сделано.
